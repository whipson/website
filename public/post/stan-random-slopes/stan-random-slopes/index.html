<!DOCTYPE html>
    
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 3.3.0">
  <meta name="generator" content="Hugo 0.54.0" />
  <meta name="author" content="Will Hipson">

  
  
  
  
    
  
  <meta name="description" content="library(mvtnorm)library(tidyverse)## -- Attaching packages ------------------------------------------------------------------------------------------------- tidyverse 1.3.0 --## v ggplot2 3.3.1 v purrr 0.3.4## v tibble 3.0.1 v dplyr 1.0.0## v tidyr 1.1.0 v stringr 1.4.0## v readr 1.3.1 v forcats 0.5.0## -- Conflicts ---------------------------------------------------------------------------------------------------- tidyverse_conflicts() --## x dplyr::filter() masks stats::filter()## x dplyr::lag() masks stats::lag()library(gghighlight)theme_set(theme_bw())set.seed(12407)real_mean_y &lt;- 4.25real_mean_x &lt;- 3.25real_sd_y &lt;- 0.98real_sd_x &lt;- 1.12N &lt;- 30 # number of peoplen_days &lt;- 7 # number of daystotal_obs &lt;- N * n_dayserror_sd &lt;- 1.">

  
  <link rel="alternate" hreflang="en-us" href="/post/stan-random-slopes/stan-random-slopes/">

  


  

  

  

  

  

  

  
  
  
  <meta name="theme-color" content="#4caf50">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous">
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono">
  

  <link rel="stylesheet" href="/styles.css">
  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-132275491-1', 'auto');
      
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Will Hipson">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Will Hipson">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/stan-random-slopes/stan-random-slopes/">

  
  
  
  
    
    
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Will Hipson">
  <meta property="og:url" content="/post/stan-random-slopes/stan-random-slopes/">
  <meta property="og:title" content="Stan-Random-Slopes | Will Hipson">
  <meta property="og:description" content="library(mvtnorm)library(tidyverse)## -- Attaching packages ------------------------------------------------------------------------------------------------- tidyverse 1.3.0 --## v ggplot2 3.3.1 v purrr 0.3.4## v tibble 3.0.1 v dplyr 1.0.0## v tidyr 1.1.0 v stringr 1.4.0## v readr 1.3.1 v forcats 0.5.0## -- Conflicts ---------------------------------------------------------------------------------------------------- tidyverse_conflicts() --## x dplyr::filter() masks stats::filter()## x dplyr::lag() masks stats::lag()library(gghighlight)theme_set(theme_bw())set.seed(12407)real_mean_y &lt;- 4.25real_mean_x &lt;- 3.25real_sd_y &lt;- 0.98real_sd_x &lt;- 1.12N &lt;- 30 # number of peoplen_days &lt;- 7 # number of daystotal_obs &lt;- N * n_dayserror_sd &lt;- 1."><meta property="og:image" content="/img/portrait.jpg">
  <meta property="og:locale" content="en-us">
  
  
  
  

  

  

  <title>Stan-Random-Slopes | Will Hipson</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Will Hipson</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#publications_selected">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/files/Academic%20CV.pdf">
            
            <span>CV</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/shiny/">
            
            <span>Apps</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
            
          
        

        <li class="nav-item">
          <a class="nav-link" href="https://www.r-bloggers.com/" target="_blank" rel="noopener">
            
            <span>R-bloggers</span>
            
          </a>
        </li>

        
        

      

        

        

        

        

      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Stan-Random-Slopes</h1>

  

  
    

<div class="article-metadata">

  
  
  <span itemscope itemprop="author" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Will Hipson">
  </span>
  

  <span class="article-date">
    
    <meta content="" itemprop="datePublished">
    <time datetime="" itemprop="dateModified">
      Jan 1, 0001
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Will Hipson">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    8 min read
  </span>
  

  
  

  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Stan-Random-Slopes&amp;url=%2fpost%2fstan-random-slopes%2fstan-random-slopes%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2fstan-random-slopes%2fstan-random-slopes%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2fstan-random-slopes%2fstan-random-slopes%2f&amp;title=Stan-Random-Slopes"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2fstan-random-slopes%2fstan-random-slopes%2f&amp;title=Stan-Random-Slopes"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Stan-Random-Slopes&amp;body=%2fpost%2fstan-random-slopes%2fstan-random-slopes%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

    















  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      


<pre class="r"><code>library(mvtnorm)
library(tidyverse)</code></pre>
<pre><code>## -- Attaching packages ------------------------------------------------------------------------------------------------- tidyverse 1.3.0 --</code></pre>
<pre><code>## v ggplot2 3.3.1     v purrr   0.3.4
## v tibble  3.0.1     v dplyr   1.0.0
## v tidyr   1.1.0     v stringr 1.4.0
## v readr   1.3.1     v forcats 0.5.0</code></pre>
<pre><code>## -- Conflicts ---------------------------------------------------------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(gghighlight)

theme_set(theme_bw())
set.seed(12407)

real_mean_y &lt;- 4.25
real_mean_x &lt;- 3.25
real_sd_y &lt;- 0.98
real_sd_x &lt;- 1.12

N &lt;- 30 # number of people
n_days &lt;- 7 # number of days
total_obs &lt;- N * n_days
error_sd &lt;- 1.05
N_grp &lt;- 3

sd_int_x &lt;- 0.50 # sd for x (standardized)
sd_beta_x &lt;- 0.40 # sd for y (standardized)
rho_x &lt;- -0.55 # covariance between intercepts and slopes
mean_intercept_x &lt;- 0 # average intercept (standardized)
mean_beta_x &lt;- 0.25 # average effect of x (standardized)

cov_mat_x &lt;- matrix(c(sd_int_x^2, sd_int_x * sd_beta_x * rho_x, sd_int_x * sd_beta_x * rho_x, sd_beta_x^2), nrow = 2)
xy_corr &lt;- rmvnorm(N, mean = c(mean_intercept_x, mean_beta_x), sigma = cov_mat_x)

z_matrix &lt;- matrix(c(-0.14, 0.16, 0.43, # group intercepts
                     0.35, 0.02, -0.85 # group slopes
                     ), nrow = 3)

x &lt;- map(1:N, ~ rnorm(7, 0, 1))

z &lt;- rep(1:N_grp, each = 10)
pid &lt;- 1:N
zid &lt;- 1:3

dat &lt;- map2_dfr(1:N, z, ~ data.frame(y = xy_corr[.x, 1] + xy_corr[.x, 2] * x[[.x]] + 
                                       z_matrix[.y, 1] + z_matrix[.y, 2] * x[[.x]]
                                     + rnorm(n_days, mean = 0, sd = error_sd),
                               x = x[[.x]],
                               z = zid[[.y]]), .id = &quot;pid&quot;) %&gt;%
  mutate(y = real_mean_y + y * real_sd_y,
         x = real_mean_x + x * real_sd_x,
         z = z)

ggplot(data = dat, aes(x = x, y = y, group = pid)) +
  geom_point(shape = 1, size = 2) +
  facet_wrap(~z) +
  geom_line(stat = &quot;smooth&quot;, method = &#39;lm&#39;, se = FALSE, alpha = .75, color = &quot;dodgerblue2&quot;, size = 1)</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="/post/stan-random-slopes/stan-random-slopes_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<div id="watch-those-priors" class="section level2">
<h2>Watch Those Priors</h2>
<pre class="r"><code>grid &lt;- seq(-3, 3, length.out = 1000)

alpha_prior &lt;- map_dfr(.x = c(0.5, 1, 2), ~ data.frame(
  grid = grid,
  alpha = dnorm(grid, mean = 0, sd = .x)),
  .id = &quot;sigma_id&quot;)

alpha_prior &lt;- alpha_prior %&gt;%
  mutate(sigma_id = factor(sigma_id, labels = c(&quot;normal(0, 0.5)&quot;,
                                                &quot;normal(0, 1)&quot;,
                                                &quot;normal(0, 2)&quot;)))

ggplot(alpha_prior, aes(x = grid, y = alpha)) +
  geom_area(fill = &quot;cadetblue4&quot;, color = &quot;black&quot;, alpha = 0.90) +
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 0.85)) +
  labs(x = NULL,
       y = &quot;density&quot;,
       title = &quot;alpha (intercept) priors&quot;) +
  facet_wrap(~sigma_id, nrow = 3)</code></pre>
<p><img src="/post/stan-random-slopes/stan-random-slopes_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<pre class="r"><code>alpha_beta &lt;- map2_df(.x = c(0.5, 1, 2), .y = c(0.25, 0.5, 1), ~ data.frame(
  alpha = rnorm(100, mean = 0, sd = .x), 
  beta = rnorm(100, mean = 0, sd = .y)), .id = &quot;sigma_id&quot;
)

alpha_beta &lt;- alpha_beta %&gt;%
  mutate(sigma_id = factor(sigma_id, labels = c(&quot;alpha ~ normal(0, 0.5); beta ~ normal(0, 0.25)&quot;,
                                                &quot;alpha ~ normal(0, 1); beta ~ normal(0, 0.50)&quot;,
                                                &quot;alpha ~ normal(0, 2); beta ~ normal(0, 1)&quot;)))

ggplot(alpha_beta) +
  geom_abline(aes(intercept = alpha, slope = beta), color = &quot;cadetblue4&quot;, alpha = 0.75) +
  scale_x_continuous(limits = c(-2, 2)) +
  scale_y_continuous(limits = c(-3, 3)) +
  labs(x = &quot;X&quot;,
       y = &quot;Y&quot;,
       title = &quot;Sampling of lines from alpha and beta priors&quot;) +
  facet_wrap(~sigma_id, nrow = 3)</code></pre>
<p><img src="/post/stan-random-slopes/stan-random-slopes_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div id="advanced-prior-predictive-check" class="section level3">
<h3>Advanced: Prior Predictive Check</h3>
<pre class="r"><code>priors &lt;- list(alpha = rnorm(1, mean = 0, sd = 1),
               beta = rnorm(1, mean = 0, sd = 0.5),
               sigma_e = rexp(1, 1),
               sigma_pt = rexp(2, 1),
               z_t = matrix(c(rnorm(30, 0, 1), rnorm(30, 0, 1)), nrow = 2),
               L_pt = rethinking::rlkjcorr(n = 1, K = 2, eta = 4),
               x = rnorm(210, mean = 0, sd = 1),
               pid = rep(1:30, each = 7))

prior_corr &lt;- (diag(priors$sigma_pt) %*% priors$L_pt %*% diag(priors$sigma_pt)) %*% priors$z_t
sim_dat &lt;- with(priors, data.frame(mu = alpha + prior_corr[1, pid] + (beta + prior_corr[2, pid]) * x,
                                   x = x,
                                   pid = pid)) %&gt;%
  mutate()

sim_dat$y &lt;- rnorm(210, sim_dat$mu, priors$sigma_e)

sim_dat %&gt;%
  ggplot(aes(x = x, y = y, group = pid)) +
  geom_point(size = 3, color = &quot;cadetblue4&quot;) +
  gghighlight(pid == 4, use_group_by = FALSE, max_highlight = Inf, use_direct_label = FALSE) +
  labs(title = &quot;Data simulated from priors&quot;,
       subtitle = &quot;Green points are from a random participant. Grey points are from all other participants.&quot;)</code></pre>
<p><img src="/post/stan-random-slopes/stan-random-slopes_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
</div>
<div id="stan-basics" class="section level2">
<h2>Stan Basics</h2>
<p>Every Stan model code must contain the following three blocks:</p>
<ol style="list-style-type: decimal">
<li>Data - where you define the data and the dimensions of the data.</li>
<li>Parameters - where you describe the unknown parameters that you want to estimate.</li>
<li>Model - where you list the priors and define the likelihood function for the model.</li>
</ol>
<p>To see how these all fit together, we’ll start with a simple (albeit inappropriate) model for this data - one in which we completely ignore the grouping of the data within participants and instead treat each observation as completely independent from the others. This is not the way to analyze this data, but I use it as a simple demonstration of how to construct Stan code. So if you already have a grasp of basic Stan syntax, feel free to skip to the next section.</p>
<p>For an R user, the best way to write Stan code is to use RStudio’s built-in Stan file generator. If you have Stan installed, when you select the drop down options for a new file, you can select ‘Stan file’. This lets you take advantage of autocompletion and syntax error detection.</p>
<p>To make it clear which code snippets are in Stan code, I will use <code class="stan">// STAN CODE</code> at the beginning of the block (<code class="stan">//</code> denotes a comment and is not evaluated).</p>
<div id="data" class="section level3">
<h3>Data</h3>
<p>The data block is where we define our observed variables. Stan requires that we be explicit about the <em>type</em> and <em>dimensions</em> of our data before we declare them. So we first start by declaring an integer variable N to be the number of observations: <code class="stan">int N;</code> (note the use of semicolon to denote the end of a line). For our variables x and y, we tell Stan that they are vectors of length N containing real numbers (e.g., 0.4, -0.32, etc.): <code class="stan">real x[N]; real y[N];</code>.</p>
<pre class="stan"><code>// STAN CODE
data {
  int N; // number of observations
  real x[N]; // x vector
  real y[N]; // y vector
}</code></pre>
</div>
<div id="parameters" class="section level3">
<h3>Parameters</h3>
<p>Now we tell Stan the parameters in our model. These are the unobserved variables that we want to estimate. In this example, we have 3 parameters: <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, and <span class="math inline">\(\sigma\)</span>. Like before, we first tell Stan the type of data this parameter will contain - in this case, all are <code class="stan">real</code>. We use <code class="stan">&lt;lower=0&gt;</code> to constrain <code class="stan">sigma</code> to be positive because it is impossible to have negative standard deviation.</p>
<pre class="stan"><code>// STAN CODE
parameters {
  real alpha;
  real beta;
  real&lt;lower=0&gt; sigma; // constrained to be positive
}</code></pre>
</div>
<div id="model" class="section level3">
<h3>Model</h3>
<p>The model block is where the action is at. We start with our priors. There should be a prior for each parameter declared above.</p>
<pre class="stan"><code>// STAN CODE
model {
  // priors
  alpha ~ normal(0, 1);
  beta ~ normal(0, 1);
  sigma ~ exponential(1); // using an exponential prior on sigma
  
  // likelihood
  vector mu[N]; // declaring a mu vector
  
  for(i in 1:N) {
    mu[i] = alpha + beta * x[i];
  }
  
  y ~ normal(mu, sigma);
}</code></pre>
<p>It’s common to see a model block like this written more compactly,</p>
<pre class="stan"><code>// STAN CODE
model {
  // priors
  alpha ~ normal(0, 1);
  beta ~ normal(0, 1);
  sigma ~ exponential(1); // using an exponential prior on sigma
  
  // likelihood
  y ~ normal(alpha + beta * x, sigma);
}</code></pre>
<p>but I find the more verbose code easier to read and interpret. Especially as models become more complex, keeping things explicit saves a lot of headache down the road.</p>
</div>
<div id="full-stan-code" class="section level3">
<h3>Full Stan Code</h3>
<p>The full Stan code looks like this:</p>
<pre class="stan"><code>// STAN CODE
data {
  int N; // number of observations
  real x[N]; // x vector
  real y[N]; // y vector
}

parameters {
  real alpha;
  real beta;
  real&lt;lower=0&gt; sigma; // constrained to be positive
}

model {
  // priors
  alpha ~ normal(0, 1);
  beta ~ normal(0, 1);
  sigma ~ exponential(1); // using an exponential prior on sigma
  
  // likelihood
  vector mu[N]; // declaring a mu vector
  
  for(i in 1:N) {
    mu[i] = alpha + beta * x[i];
  }
  
  y ~ normal(mu, sigma);
}</code></pre>
<p>Saving this file will give it a .stan file extension. It’s a good idea to save it in your project directory. I’ll name this model <code class="R">"mod1.stan"</code>.</p>
</div>
<div id="running-the-model" class="section level3">
<h3>Running the Model</h3>
<p>Now we go back to R to run the model. Open an R script and load in rstan.</p>
<pre class="r"><code>library(rstan)</code></pre>
<p>We need to give put the data in a list for Stan. Everything that we declared in the data block of our Stan code should be entered into this list.</p>
<pre class="r"><code>stan_dat &lt;- list(
  N = nrow(dat), # using nrow() to get the number of rows (observations)
  x = dat$x,
  y = dat$y
)</code></pre>
<p>Finally, we use the function <code class="R">stan</code> to run the model.</p>
<pre class="r"><code>stan_fit1 &lt;- stan(file = &quot;mod1.stan&quot;,
                  data = stan_dat,
                  chains = 4, cores = 4)</code></pre>
<pre class="stan"><code>data {
  int N_obs; // number of observations
  int N_pts; // number of participants
  int N_days; // number of days per participant
  int pid[N_obs]; // participant id vector
  real x[N_obs]; // x vector
  real y[N_obs]; // y vector
}

parameters {
  real alpha; // average intercept
  real beta; // average slope
  real&lt;lower=0&gt; sigma_e; // average error
  vector&lt;lower=0&gt;[2] sigma_pt; // participant intercept and slope sd
  cholesky_factor_corr[2] L_pt; // lkj matrix for pt intercept and slope
  matrix[2, N_pts] z_pt; // standardized correlation matrix
}

transformed parameters {
  matrix[2, N_pts] corr;
  corr = diag_pre_multiply(sigma_pt, L_pt) * z_pt;
  // above line is equivalent to (diag(sigma_pt) %*% L_pt %*% diag(sigma_pt)) %*% z_pt in R
}

model {
  vector[N_obs] mu;
  
  // priors
  L_pt ~ lkj_corr_cholesky(1.5);
  to_vector(z_pt) ~ normal(0, 1);
  sigma_e ~ exponential(1);
  sigma_pt ~ exponential(1);
  alpha ~ normal(0, 1);
  beta ~ normal(0, 0.5);
  
  // likelihood
  for(i in 1:N_obs) {
    mu[i] = alpha + corr[1, pid[i]] + (beta + corr[2, pid[i]]) * x[i];
  }
  y ~ normal(mu, sigma_e);
}

generated quantities {
  matrix[2, 2] Omega;
  Omega = L_pt * L_pt&#39;;
}</code></pre>
<pre class="r"><code>library(rstan)
stan_dat &lt;- list(
  N_obs = nrow(dat),
  N_pts = max(as.numeric(dat$pid)),
  N_days = 7,
  pid = as.numeric(dat$pid),
  x = (mean(dat$x) - dat$x)/sd(dat$x),
  y = (mean(dat$y) - dat$y/sd(dat$y))
)

mod1 &lt;- stan(file = &quot;~/R/Will Hipson/stan-models/mod1.stan&quot;,
             data = stan_dat,
             chains = 1)

mod1</code></pre>
</div>
</div>

    </div>

    

    






<div class="media author-card" itemscope itemtype="http://schema.org/Person">
  
  <img class="portrait mr-3" src="/img/portrait.jpg" itemprop="image" alt="Avatar">
  
  <div class="media-body">
    <h5 class="card-title" itemprop="name"><a href="/">Will Hipson</a></h5>
    <h6 class="card-subtitle">PhD Candidate, Psychology</h6>
    
    <ul class="network-icon" aria-hidden="true">
      
      
      
      
        
      
      
      
      
      
      <li>
        <a itemprop="sameAs" href="mailto:william.hipson@carleton.ca" >
          <i class="fas fa-envelope"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://twitter.com/whipson3" target="_blank" rel="noopener">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
      
      
      
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://scholar.google.com/citations?user=NjVAwkcAAAAJ&amp;hl=en" target="_blank" rel="noopener">
          <i class="ai ai-google-scholar"></i>
        </a>
      </li>
      
      
      
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://www.researchgate.net/profile/Will_Hipson" target="_blank" rel="noopener">
          <i class="ai ai-researchgate"></i>
        </a>
      </li>
      
      
      
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://www.mendeley.com/profiles/will-hipson/" target="_blank" rel="noopener">
          <i class="ai ai-mendeley"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://github.com/whipson?tab=repositories" target="_blank" rel="noopener">
          <i class="fab fa-github"></i>
        </a>
      </li>
      
      
      
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://osf.io/profile/" target="_blank" rel="noopener">
          <i class="ai ai-osf"></i>
        </a>
      </li>
      
    </ul>
  </div>
</div>




    
    

    

    


  </div>
</article>

<div class="container">
  <footer class="site-footer">
  
  <p class="powered-by">
    <a href="/privacy/">Privacy Policy</a>
  </p>
  

  <p class="powered-by">
    &copy; 2020 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    

    
    

    

    
    

    
    

    
    
    
    
    
    
    
    
    <script src="/js/academic.min.70f0041f5a24c6a675ac218c98d7ef71.js"></script>

    

  </body>
</html>

